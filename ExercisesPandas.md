# Pandas 演習

## 1. データの取得

まずはPandasでデータ処理について取り組む前に、データを取得しましょう。
今回は法人マイナンバーのCSVが公開されていますので、そちらを使いましょう。

下記サイトより、東京都の企業データのダウンロードをして解凍まで行いましょう。

http://www.houjin-bangou.nta.go.jp/download/zenken/#csv-unicode


## 2. pandasを利用してCSVデータの読み込み

解凍後、`13_tokyo_all_20151130.csv` のデータを`pandas`を使い`DataFrame`オブジェクトとして読み込みましょう。

注意する点は、このcsvデータでは一行目からデータが開始していますので、column名にあたる行はありません。
また読み込む際の文字コードの指定なども気をつけてください。

```python

>>> import pandas as pd

>>> df = pd.read_csv(...)

>>> print(df.head())
   0              1   2   3           4           5          6   7    8    9   \
0   1  1000011000005   1   0  2015-10-26  2015-10-05    国立国会図書館 NaN  101  東京都   
1   2  1000012010003   1   0  2015-10-26  2015-10-05      内閣法制局 NaN  101  東京都   
2   3  1000012010011   1   0  2015-10-26  2015-10-05  郵政民営化推進本部 NaN  101  東京都   
3   4  1000012010028   1   0  2015-10-26  2015-10-05  国土強靱化推進本部 NaN  101  東京都   
4   5  1000012020002   1   0  2015-10-26  2015-10-05   公害等調整委員会 NaN  101  東京都   

      ...      13   14       15  16  17   18  19  20   21          22  
0     ...      13  101  1000014 NaN NaN  NaN NaN NaN  NaN  2015-10-05  
1     ...      13  101  1000013 NaN NaN  NaN NaN NaN  NaN  2015-10-05  
2     ...      13  101  1000014 NaN NaN  NaN NaN NaN  NaN  2015-10-05  
3     ...      13  101  1000014 NaN NaN  NaN NaN NaN  NaN  2015-10-05  
4     ...      13  101  1000013 NaN NaN  NaN NaN NaN  NaN  2015-10-05  

[5 rows x 23 columns]
```

## 3. データの確認

下記の内容を満たすコードを書いてください。全て一行で書けます。

1. `DataFrame`の行数が知りたい
2. `DataFrame`の行数と列数が同時に知りたい
3. `DataFrame`のカラム情報が一覧で知りたい
4. `DataFrame`の各カラムの基礎統計量が知りたい
5. 先頭10行の中身を確認したい
6. 末尾10行の中身を確認したい
6. index が 10 の行を抜き出して表示したい

## 4. 列名の変更と列の順序の変更

`DataFrame`は`columns`を変更することで、カラム名を変更することができます。
http://www.houjin-bangou.nta.go.jp/documents/k-resource-dl.pdf を参考にして、

- 商号又は名称
- 法人番号
- 処理区分
- 法人種別
- 国内所在地（都道府県）
- 国内所在地（市区町村）
- 国内所在地（丁目番地等）

の列だけに`DataFrame`の列を指定しなおしましょう。列の順序のこの通りでお願いします。
また、列名は英語表記で上記PDFの各列を小文字にしたものにしてください。

変更後の`DataFrame`は`df_tokyo`という変数名にしましょう。こちらも一行で書いてみましょう。長くなる場合は、改行しても構いません。

**以降の問題では、扱う`DataFrame`を`df_tokyo`としてください。**

## 5. 抽出

下記の内容を満たすコードを書いてください。全て一行で書けます。

1. 国内所在地（市区町村）が"渋谷区"に一致するデータの件数が知りたい
2. 国内所在地（丁目番地等）に"５丁目"が含まれているデータの件数が知りたい
3. 法人番号を120で割ったときの余りが0となるデータの件数を知りたい

## 6. 欠損値の扱い

このデータにはいくつか**欠損値**があるようです。

1. `dropna`を使って欠損値除去前後のデータの件数の差異を調べましょう。
2. #3に登場したコマンドにて、欠損値が含まれているカラムを特定してみましょう（他にも特定方法がありますので、調べてみましょう）。
3. 今回は欠損値が含まれている行の削除はせず、空白で**穴埋め**を行いましょう。

## 7. グループ演算

商号又は名称が同じですが、法人番号が異なるデータがいくつかあります（住所が異なる場合）。

1. 商号又は名称毎に法人番号のユニークな件数をカウントしましょう。
2. その結果に対して、ユニークな件数が2以上の商号又は名称は何件あるでしょうか ?

## 8. 前処理（クレンジング）

問題設定
> この後別の企業データとマージさせたいですが、どうやら形式が異なるようです。そこでデータの中身に対して処理をかけます。

```python
s1 = "　　渋谷区100丁目９９９９　－1 Aビル2階  "
s2 = "　　渋谷区100丁目９９９９番　－1号 Aビル2階  "
```
という文字列に対して

1. 全角英数字を半角英数字に変換する
2. スペースは全て詰める（除去する）
3. hoge丁目geho番wow号 を hoge-goho-wow に置換する
4. hoge階は、hogeFに置換する

を行う関数`normalize_text`を作りましょう。

作成後、`map`関数を適用させます。

```python
df_tokyo['street'] = df_tokyo['street'].map(normalize_text)
```

## 9. 重複の確認

法人番号について、重複があるかどうかを確認するコードを書きましょう。

## 10. Merge

別の`DataFrame`に対して、下記のような構造のデータがあった場合

- 商号又は名称
- 国内所在地（都道府県）
- 国内所在地（市区町村）
- 国内所在地（丁目番地等）

これと`df_tokyo`を"商号又は名称", "国内所在地（都道府県）"でjoinをした場合

1. 内部結合(inner join)するコード
2. 外部結合(left outer join)するコード

をそれぞれ書きましょう。


